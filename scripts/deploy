#!/bin/bash 
TODAY=$(date)
HOST=$(hostname)


echo "<-------------------------------------------------------->"
echo "<-- today is : $TODAY  and host is :  $HOST           --->"
echo "<-- script 'deploy' :                                  -->"
echo "<--   + update wp to minor version if enabled          -->"
echo "<--   + update wp options to re7 values                -->"
echo "<--     - url - home - blogname - desc - email         -->"
echo "<--     - stylesheet - template                        -->"
echo "<-------------------------------------------------------->"

# updating wordpress to minor version
wp core check-update --path=/var/www/html/ --minor --skip-themes=all

# load database update

# change 'hellodorado' to 'helldorado' on all tables before updating options
wp search-replace --all-tables 'http://dev1.websiteserverhost.com/hellodorado' 'https://re7.helldorado.fr'

# update wp options from database
wp option update siteurl 'https://re7.helldorado.fr'
wp option update home 'https://re7.helldorado.fr'
wp option update blogname 'Hell Dorado'
wp option update blogdescription "Les lois Ã©ternelles de l'enfer"
wp option update admin_email 'contact.laguilde@helldorado'
wp option update template 'helldorado'
wp option update stylesheet 'helldorado'

# theme test plugin
wget https://wpcom-themes.svn.automattic.com/demo/theme-unit-test-data.xml
mv -f theme-unit-test-data.xml ../tests/

