#!/usr/bin/env groovy

node('master'){
    checkout scm
    stage('Build'){
        echo 'Building...'
    }
    stage('Test'){
        echo 'Testing...'
    }
    stage('Deploy'){
        echo 'Deploying...'
        sshagent (credentials: ['ssh-jenkins-to-ubuntu-cred']) {
                sh "echo 'copying wp-content/themes/HellDorado'" 
                sh "scp -r -P 443  wp-content/themes/HellDorado jenkins@re7.helldorado.fr:/var/www/html/wp-content/themes/"
                sh "echo 'copying scripts'"
                sh "scp -r -P 443 scripts jenkins@re7.helldorado.fr:/var/www/html/"
                sh "echo 'copying liquibase scripts'"
                sh "scp -r -P 443 Database jenkins@re7.helldorado.fr:/var/www/html/"
                sh '''ssh -p 443 jenkins@re7.helldorado.fr << 'ENDSSH'
                    echo 'making scripts runnable'
                    chmod -R ug+x /var/www/html/scripts
                    echo 'running script Deploy...'
                    bash -s -- < /var/www/html/scripts/deploy --wprtest-import
                    ENDSSH'''
       }
    }
}

