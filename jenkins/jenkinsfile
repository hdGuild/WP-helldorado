#!/usr/bin/env groovy

node('master'){
    checkout scm
    stage('Build'){
        echo 'Building...'
    }
    stage('Test'){
        echo 'Testing...'
    }
    stage('Deploy'){
        echo 'Deploying...'
        sshagent (credentials: ['ssh-jenkins-to-ubuntu-cred']) {
                sh '''echo copying wp-content/themes/HellDorado theme
                rsync -avz -e "ssh" wp-content/themes/HellDorado jenkins@re7.helldorado.fr:wp-content/themes/HellDorado
                echo copying scripts
                rsync -avz -e "ssh" scripts jenkins@re7.helldorado.fr:scripts
                echo making scripts/* runnable
                chmod -R ug+x /var/www/html/scripts
                echo copying database liquibase scripts
                rsync -avz -e "ssh" Database jenkins@re7.helldorado.fr:Database
                echo running scripts/deploy...
                ./var/www/html/scripts/deploy --wptest-import
                '''
       }
    }
}

